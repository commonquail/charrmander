<Window x:Class="Charrmander.View.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vw="clr-namespace:Charrmander.View"
        Title="{Binding WindowTitle}" Height="350" Width="525"
        Icon="/Icons/Game/MainTitle.png" AllowDrop="True" Drop="Window_Drop">

    <Window.InputBindings>
        <KeyBinding Gesture="Ctrl+N" Command="{Binding CommandNewCharacter}"/>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding CommandOpen}"/>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding CommandSave}"/>
    </Window.InputBindings>
    <Window.Resources>
        <BitmapImage x:Key="IconMenuOpen" UriSource="/Icons/Open.bmp"/>
        <BitmapImage x:Key="IconMenuSave" UriSource="/Icons/Save.bmp"/>

        <ImageSource x:Key="IconAreaHeart">/Icons/Game/Areas/Heart.png</ImageSource>
        <ImageSource x:Key="IconAreaWaypoint">/Icons/Game/Areas/Waypoint.png</ImageSource>
        <ImageSource x:Key="IconAreaPoI">/Icons/Game/Areas/PoI.png</ImageSource>
        <ImageSource x:Key="IconAreaSkill">/Icons/Game/Areas/Skill.png</ImageSource>
        <ImageSource x:Key="IconAreaVista">/Icons/Game/Areas/Vista.png</ImageSource>

        <ImageSource x:Key="IconAreaHeartDone">/Icons/Game/Areas/HeartDone.png</ImageSource>
        <ImageSource x:Key="IconAreaWaypointDone">/Icons/Game/Areas/WaypointDone.png</ImageSource>
        <ImageSource x:Key="IconAreaPoIDone">/Icons/Game/Areas/PoIDone.png</ImageSource>
        <ImageSource x:Key="IconAreaSkillDone">/Icons/Game/Areas/SkillDone.png</ImageSource>
        <ImageSource x:Key="IconAreaVistaDone">/Icons/Game/Areas/VistaDone.png</ImageSource>

        <XmlDataProvider x:Key="ProfessionsXml" XPath="Professions/Profession" Source="/Resources/Professions.xml"/>
        <XmlDataProvider x:Key="RacesXml" XPath="Races/Race" Source="/Resources/Races.xml"/>

        <vw:GameIconConverter x:Key="GameIconConverter"/>
    </Window.Resources>

    <DockPanel>
        <Menu Height="23" HorizontalAlignment="Stretch" VerticalAlignment="Top" DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_New Character" Command="{Binding CommandNewCharacter}" InputGestureText="Ctrl+N"/>
                <Separator/>
                <MenuItem Header="_Open" Command="{Binding CommandOpen}" InputGestureText="Ctrl+O">
                    <MenuItem.Icon>
                        <Image Source="{StaticResource IconMenuOpen}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Save" Command="{Binding CommandSave}" InputGestureText="Ctrl+S">
                    <MenuItem.Icon>
                        <Image Source="{StaticResource IconMenuSave}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Save As" Command="{Binding CommandSaveAs}"/>
                <Separator/>
                <MenuItem Header="_Exit" Command="{Binding CommandExit}" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="Check for updates" Command="{Binding CommandCheckUpdate}"/>
                <MenuItem Header="Register File Extension" Command="{Binding CommandRegisterExtension}"/>
            </MenuItem>
        </Menu>

        <DockPanel>
            <DockPanel.Resources>
                <vw:NamelessCharacterConverter x:Key="NamelessCharacterConverter"/>
            </DockPanel.Resources>

            <ListBox Width="150" ItemsSource="{Binding CharacterList}" SelectedItem="{Binding SelectedCharacter}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding Path=Name, Converter={StaticResource NamelessCharacterConverter}}"/>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="_New Character" Command="{Binding CommandNewCharacter}" InputGestureText="Ctrl+N"/>
                        <MenuItem Header="Delete Selected" Command="{Binding CommandDeleteCharacter}"
                                  IsEnabled="{Binding IsCharacterDetailEnabled}"/>
                    </ContextMenu>
                </ListBox.ContextMenu>
            </ListBox>

            <TabControl IsEnabled="{Binding IsCharacterDetailEnabled}">
                <TabItem Header="Personal" Name="personal">
                    <TabItem.Resources>
                        <vw:GameIconConverter x:Key="GameIconConverter"/>

                        <DataTemplate DataType="Profession">
                            <StackPanel Orientation="Horizontal">
                                <Image Height="20" Width="20"
                                       Source="{Binding XPath=Name,
                                    Converter={StaticResource GameIconConverter}, ConverterParameter=Professions}"/>
                                <TextBlock Text="{Binding XPath=Name, StringFormat={} {0}}"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>

                        <DataTemplate DataType="Race">
                            <StackPanel Orientation="Horizontal">
                                <Image Height="20" Width="20"
                                       Source="{Binding XPath=Name, Converter={StaticResource GameIconConverter}, ConverterParameter=Races}"/>
                                <TextBlock Text="{Binding XPath=Name, StringFormat={} {0}}"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.Resources>

                    <StackPanel >
                        <Grid VerticalAlignment="Top">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="30.05"/>
                                <RowDefinition Height="30.05"/>
                                <!--
                            <RowDefinition Height="30.05"/>
                            <RowDefinition Height="30.05"/>
                            <RowDefinition Height="30.05"/>
                            <RowDefinition Height="30.05"/>
                            <RowDefinition Height="30.05"/>
                            -->
                            </Grid.RowDefinitions>

                            <Label Grid.Column="0" Grid.Row="0">Name:</Label>
                            <Label Grid.Column="0" Grid.Row="1" VerticalAlignment="Center">Race:</Label>
                            <Label Grid.Column="0" Grid.Row="2" VerticalAlignment="Center">Profession:</Label>

                            <TextBox HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                 Grid.Column="1" Grid.Row="0"
                                 Text="{Binding SelectedCharacter.Name}"/>
                            <ComboBox HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                  Grid.Column="1" Grid.Row="1" Height="26"
                                  ItemsSource="{Binding Source={StaticResource RacesXml}}"
                                  SelectedValue="{Binding SelectedCharacter.Race}"
                                  SelectedValuePath="Name" SelectionChanged="ComboBox_SelectionChanged"/>
                            <ComboBox HorizontalAlignment="Stretch" VerticalAlignment="Center"
                                  Grid.Column="2" Grid.Row="2" Height="26"
                                  ItemsSource="{Binding Source={StaticResource ProfessionsXml}}"
                                  SelectedValue="{Binding SelectedCharacter.Profession}"
                                  SelectedValuePath="Name" SelectionChanged="ComboBox_SelectionChanged"/>

                        </Grid>
                        <GroupBox Header="Biography">
                            <StackPanel>
                                <StackPanel.Resources>
                                    <Style TargetType="{x:Type DockPanel}">
                                        <Setter Property="Margin" Value="0,2"/>
                                    </Style>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Setter Property="Width" Value="94"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                    <Style TargetType="{x:Type ComboBox}">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </StackPanel.Resources>

                                <DockPanel>
                                    <TextBlock Text="Profession:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsProfession}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyProfession}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Personality:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsPersonality}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyPersonality}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Racial 1:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsRaceFirst}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyRaceFirst}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Racial 2:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsRaceSecond}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyRaceSecond}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Racial 3:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsRaceThird}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyRaceThird}"/>
                                </DockPanel>

                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </TabItem>

                <TabItem Header="Areas">
                    <DockPanel>
                        <ListBox SelectedItem="{Binding SelectedAreaReference}"
                                 ItemsSource="{Binding AreaReferenceList}"
                                 DisplayMemberPath="Name" Width="150"/>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="5*"/>
                                <RowDefinition Height="5*"/>
                                <RowDefinition Height="5*"/>
                                <RowDefinition Height="5*"/>
                                <RowDefinition Height="5*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.Resources>
                                <Style x:Key="CompletionLabel" TargetType="Label">
                                    <Setter Property="ContentStringFormat" Value="{}/{0,3}"/>
                                </Style>
                                <Style TargetType="{x:Type TextBox}">
                                    <EventSetter Event="GotKeyboardFocus" Handler="txtGotKeyboardFocus"/>
                                    <EventSetter Event="PreviewMouseLeftButtonDown" Handler="txtPreviewMouseLeftButtonDown"/>
                                </Style>
                            </Grid.Resources>

                            <Image Grid.Column="0" Grid.Row="0" Source="{Binding HeartIcon,
                                Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                            <Image Grid.Column="0" Grid.Row="1" Source="{Binding WaypointIcon,
                                Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                            <Image Grid.Column="0" Grid.Row="2" Source="{Binding PoIIcon,
                                Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                            <Image Grid.Column="0" Grid.Row="3" Source="{Binding SkillIcon,
                                Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                            <Image Grid.Column="0" Grid.Row="4" Source="{Binding VistaIcon,
                                Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>

                            <TextBox VerticalAlignment="Center" Grid.Column="1" Grid.Row="0"
                                     Name="txtHearts" Text="{Binding Hearts}" TextAlignment="Right"/>
                            <TextBox VerticalAlignment="Center" Grid.Column="1" Grid.Row="1"
                                     Name="txtWaypoints" Text="{Binding Waypoints}" TextAlignment="Right"/>
                            <TextBox VerticalAlignment="Center" Grid.Column="1" Grid.Row="2"
                                     Name="txtPoIs" Text="{Binding PoIs}" TextAlignment="Right"/>
                            <TextBox VerticalAlignment="Center" Grid.Column="1" Grid.Row="3"
                                     Name="txtSkills" Text="{Binding Skills}" TextAlignment="Right"/>
                            <TextBox VerticalAlignment="Center" Grid.Column="1" Grid.Row="4"
                                     Name="txtVistas" Text="{Binding Vistas}" TextAlignment="Right"/>

                            <Label Name="lblHearts"
                                DataContext="{Binding SelectedAreaReference}"
                                Style="{StaticResource CompletionLabel}"
                                VerticalAlignment="Center"
                                Content="{Binding Hearts}"
                                Grid.Column="2" Grid.Row="0"/>
                            <Label
                                DataContext="{Binding SelectedAreaReference}"
                                Style="{StaticResource CompletionLabel}"
                                VerticalAlignment="Center"
                                Content="{Binding Waypoints}"
                                Grid.Column="2" Grid.Row="1"/>
                            <Label
                                DataContext="{Binding SelectedAreaReference}"
                                Style="{StaticResource CompletionLabel}"
                                VerticalAlignment="Center"
                                Content="{Binding PoIs}"
                                Grid.Column="2" Grid.Row="2"/>
                            <Label
                                DataContext="{Binding SelectedAreaReference}"
                                Style="{StaticResource CompletionLabel}"
                                VerticalAlignment="Center"
                                Content="{Binding Skills}"
                                Grid.Column="2" Grid.Row="3"/>
                            <Label
                                DataContext="{Binding SelectedAreaReference}"
                                Style="{StaticResource CompletionLabel}"
                                VerticalAlignment="Center"
                                Content="{Binding Vistas}"
                                Grid.Column="2" Grid.Row="4"/>
                        </Grid>

                    </DockPanel>
                </TabItem>

                <TabItem Header="Crafting">
                    <StackPanel>
                        <StackPanel.Resources>
                            <Style TargetType="{x:Type TextBox}">
                                <EventSetter Event="GotKeyboardFocus" Handler="txtGotKeyboardFocus"/>
                                <EventSetter Event="PreviewMouseLeftButtonDown" Handler="txtPreviewMouseLeftButtonDown"/>
                            </Style>

                            <Style TargetType="{x:Type Slider}">
                                <Setter Property="TickPlacement" Value="TopLeft"/>
                                <Setter Property="AutoToolTipPlacement" Value="BottomRight"/>
                                <Setter Property="Minimum" Value="0"/>
                                <Setter Property="Maximum" Value="400"/>
                                <Setter Property="SmallChange" Value="1"/>
                                <Setter Property="LargeChange" Value="10"/>
                                <Setter Property="Ticks" Value="0, 75, 150, 225, 300, 375, 400"/>
                                <Setter Property="Width" Value="200"/>
                                <EventSetter Event="Loaded" Handler="Slider_Loaded"/>
                            </Style>

                            <DataTemplate x:Key="CraftingDisciplineTemplate">
                                <ItemsControl ItemsSource="{Binding}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Image Source="{Binding Path=Name, Converter={StaticResource GameIconConverter},
                                                    ConverterParameter=Crafts}"
                                                       Height="20" Width="20" />

                                                <Slider Value="{Binding Level}" Name="sldCraftingDiscipline" Margin="6,2"/>

                                                <TextBox VerticalAlignment="Center" Width="35" TextAlignment="Right"
                                                         Text="{Binding ElementName=sldCraftingDiscipline, Path=Value}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </StackPanel.Resources>

                        <ContentControl
                            Content="{Binding SelectedCharacter.CraftingDisciplines}"
                            ContentTemplate="{StaticResource CraftingDisciplineTemplate}"/>

                    </StackPanel>
                </TabItem>

            </TabControl>
        </DockPanel>
    </DockPanel>
</Window>
