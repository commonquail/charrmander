<Window x:Class="Charrmander.View.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:View="clr-namespace:Charrmander.View"
        xmlns:Model="clr-namespace:Charrmander.Model"
        xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
        Title="{Binding WindowTitle}" Height="390" Width="575"
        Icon="/Icons/Game/MainTitle.png" AllowDrop="True" Drop="Window_Drop">

    <Window.InputBindings>
        <KeyBinding Gesture="Ctrl+N" Command="{Binding CommandNewCharacter}"/>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding CommandOpen}"/>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding CommandSave}"/>
    </Window.InputBindings>
    <Window.Resources>
        <BitmapImage x:Key="IconMenuOpen" UriSource="/Icons/Open.bmp"/>
        <BitmapImage x:Key="IconMenuSave" UriSource="/Icons/Save.bmp"/>

        <XmlDataProvider x:Key="ProfessionsXml" XPath="Professions/Profession" Source="/Resources/Professions.xml"/>
        <XmlDataProvider x:Key="RacesXml" XPath="Races/Race" Source="/Resources/Races.xml"/>
        <XmlDataProvider x:Key="StoryXml" XPath="StoryChoices" Source="/Resources/StoryChoices.xml"/>

        <View:GameIconConverter x:Key="GameIconConverter"/>
        <View:CompletionStateConverter x:Key="CompletionStateConverter"/>
    </Window.Resources>

    <Grid>
        <Menu Height="23" HorizontalAlignment="Stretch" VerticalAlignment="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_New Character" Command="{Binding CommandNewCharacter}" InputGestureText="Ctrl+N"/>
                <Separator/>
                <MenuItem Header="_Open" Command="{Binding CommandOpen}" InputGestureText="Ctrl+O">
                    <MenuItem.Icon>
                        <Image Source="{StaticResource IconMenuOpen}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Save" Command="{Binding CommandSave}" InputGestureText="Ctrl+S">
                    <MenuItem.Icon>
                        <Image Source="{StaticResource IconMenuSave}"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Save As" Command="{Binding CommandSaveAs}"/>
                <Separator/>
                <MenuItem Header="_Exit" Command="{Binding CommandExit}" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="Check for updates" Command="{Binding CommandCheckUpdate}"/>
                <MenuItem Header="Register File Extension" Command="{Binding CommandRegisterExtension}"/>
            </MenuItem>
            <MenuItem Header="Completion Overview" Command="{Binding CommandCompletionOverview}"
                      ToolTip="Show area completion state for all named characters."/>
        </Menu>

        <DockPanel Margin="0,23">
            <DockPanel.Resources>
                <View:NamelessCharacterConverter x:Key="NamelessCharacterConverter"/>
            </DockPanel.Resources>

            <DataGrid Width="200" ItemsSource="{Binding CharacterList}" SelectedItem="{Binding SelectedCharacter}"
                      AutoGenerateColumns="False" IsReadOnly="True" CanUserResizeRows="False" SelectionMode="Single">

                <DataGrid.RowStyle>
                    <Style TargetType="{x:Type DataGridRow}">
                        <Setter Property="ToolTip" Value="{Binding Name, Converter={StaticResource NamelessCharacterConverter}}"/>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="_New Character" Command="{Binding CommandNewCharacter}" InputGestureText="Ctrl+N"/>
                        <MenuItem Header="Delete Selected" Command="{Binding CommandDeleteCharacter}"
                                  IsEnabled="{Binding IsCharacterDetailEnabled}"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Level" MaxWidth="37" Binding="{Binding Level}"/>
                    <DataGridTextColumn Header="Name" Width="*"
                                        Binding="{Binding Name, Converter={StaticResource NamelessCharacterConverter}}"/>
                </DataGrid.Columns>
            </DataGrid>

            <TabControl IsEnabled="{Binding IsCharacterDetailEnabled}">
                <TabItem Header="Personal">
                    <TabItem.Resources>
                        <DataTemplate DataType="Profession">
                            <StackPanel Orientation="Horizontal">
                                <Image Height="20" Width="20" Source="{Binding XPath=Name,
                                    Converter={StaticResource GameIconConverter}, ConverterParameter=Professions}"/>
                                <TextBlock Text="{Binding XPath=Name, StringFormat={} {0}}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>

                        <DataTemplate DataType="Race">
                            <StackPanel Orientation="Horizontal">
                                <Image Height="20" Width="20"
                                       Source="{Binding XPath=Name, Converter={StaticResource GameIconConverter}, ConverterParameter=Races}"/>
                                <TextBlock Text="{Binding XPath=Name, StringFormat={} {0}}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </TabItem.Resources>

                    <StackPanel>
                        <StackPanel DataContext="{Binding SelectedCharacter}">
                            <StackPanel.Resources>
                                <Style TargetType="{x:Type DockPanel}">
                                    <Setter Property="Margin" Value="0,2"/>
                                </Style>

                                <Style TargetType="{x:Type TextBlock}">
                                    <Setter Property="Width" Value="100"/>
                                    <Setter Property="Padding" Value="5"/>
                                </Style>

                                <Style TargetType="{x:Type ComboBox}">
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Height" Value="26"/>
                                    <Setter Property="SelectedValuePath" Value="Name"/>
                                    <EventSetter Event="SelectionChanged" Handler="ComboBox_SelectionChanged"/>
                                </Style>
                            </StackPanel.Resources>

                            <DockPanel>
                                <TextBlock Text="Name:"/>
                                <TextBox VerticalAlignment="Center" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}"/>
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Text="Race:"/>
                                <ComboBox ItemsSource="{Binding Source={StaticResource RacesXml}}"
                                          SelectedValue="{Binding Race}"/>
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Text="Profession:"/>
                                <ComboBox ItemsSource="{Binding Source={StaticResource ProfessionsXml}}"
                                          SelectedValue="{Binding Profession}"/>
                            </DockPanel>

                            <DockPanel>
                                <TextBlock Text="Level:"/>
                                <TextBlock Text="{Binding Source={x:Static Model:Character.MaxLevel}, StringFormat='/ {0}'}"
                                           DockPanel.Dock="Right" Width="Auto"/>
                                <xctk:IntegerUpDown DockPanel.Dock="Right" Width="45"
                                                    Text="{Binding Value, ElementName=sldLevel, UpdateSourceTrigger=PropertyChanged}"
                                                    Minimum="{x:Static Model:Character.MinLevel}"
                                                    Maximum="{x:Static Model:Character.MaxLevel}"
                                                    SelectAllOnGotFocus="True"/>
                                <Slider Value="{Binding Level}" Name="sldLevel" Margin="0,2"
                                        TickPlacement="TopLeft" AutoToolTipPlacement="BottomRight"
                                        Minimum="{Binding Source={x:Static Model:Character.MinLevel}}"
                                        Maximum="{Binding Source={x:Static Model:Character.MaxLevel}}"
                                        SmallChange="1" LargeChange="10"
                                        Ticks="0, 10, 20, 30, 40, 50, 60, 70, 80"/>
                            </DockPanel>

                        </StackPanel>

                        <GroupBox Header="Biography" Visibility="{Binding IsBiographyVisible}">
                            <StackPanel>
                                <StackPanel.Resources>
                                    <Style TargetType="{x:Type DockPanel}">
                                        <Setter Property="Margin" Value="0,2"/>
                                    </Style>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Setter Property="Width" Value="94"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                    <Style TargetType="{x:Type ComboBox}">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                    </Style>
                                </StackPanel.Resources>

                                <DockPanel>
                                    <TextBlock Text="Profession:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsProfession}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyProfession}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Personality:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsPersonality}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyPersonality}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Racial 1:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsRaceFirst}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyRaceFirst}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Racial 2:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsRaceSecond}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyRaceSecond}"/>
                                </DockPanel>

                                <DockPanel>
                                    <TextBlock Text="Racial 3:"/>
                                    <ComboBox ItemsSource="{Binding BiographyOptionsRaceThird}"
                                              SelectedValue="{Binding SelectedCharacter.BiographyRaceThird}"/>
                                </DockPanel>

                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </TabItem>

                <TabItem Header="Story" IsSelected="True">
                    <StackPanel DataContext="{Binding SelectedCharacter}">
                        <ComboBox ItemsSource="{Binding Source={StaticResource StoryXml}, XPath=Order//Option}"
                                  SelectedValue="{Binding Order}"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource StoryXml}, XPath=RacialSympathy//Option}"
                                  SelectedValue="{Binding RacialSympathy}"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource StoryXml}, XPath=RetributionAlly//Option}"
                                  SelectedValue="{Binding RetributionAlly}"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource StoryXml}, XPath=GreatestFear//Option}"
                                  SelectedValue="{Binding GreatestFear}"/>
                        <ComboBox ItemsSource="{Binding Source={StaticResource StoryXml}, XPath=PlanOfAttack//Option}"
                                  SelectedValue="{Binding PlanOfAttack}"/>
                    </StackPanel>
                </TabItem>
                
                <TabItem Header="Areas">
                    <DockPanel>
                        <DataGrid ItemsSource="{Binding AreaReferenceList}" SelectedItem="{Binding SelectedAreaReference}"
                                  AutoGenerateColumns="False" IsReadOnly="True" CanUserResizeRows="False" CanUserResizeColumns="False"
                                  SelectionMode="Single" Block.TextAlignment="Right">

                            <DataGrid.HorizontalGridLinesBrush>
                                <SolidColorBrush Color="LightGray"/>
                            </DataGrid.HorizontalGridLinesBrush>

                            <DataGrid.RowStyle>
                                <Style TargetType="{x:Type DataGridRow}">
                                    <Setter Property="ToolTip" Value="{Binding LevelRange}"/>
                                </Style>
                            </DataGrid.RowStyle>

                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Mark Completed" Command="{Binding CommandCompleteArea}"/>
                                </ContextMenu>
                            </DataGrid.ContextMenu>

                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="Area Name" MinWidth="130" SortMemberPath="Name"
                                                        ClipboardContentBinding="{Binding Name}">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding State, Converter={StaticResource CompletionStateConverter}}"/>
                                                <TextBlock Text="{Binding Name}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Min" Binding="{Binding MinLevel}"/>
                                <DataGridTextColumn Header="Max" Binding="{Binding MaxLevel}"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <StackPanel Margin="6,0">
                            <StackPanel.Resources>
                                <Style TargetType="{x:Type Image}">
                                    <Setter Property="Width" Value="20"/>
                                </Style>
                                <Style TargetType="{x:Type xctk:IntegerUpDown}">
                                    <Setter Property="Width" Value="50"/>
                                    <Setter Property="Height" Value="22"/>
                                    <Setter Property="Margin" Value="2,4"/>
                                    <Setter Property="Minimum" Value="0"/>
                                    <Setter Property="SelectAllOnGotFocus" Value="True"/>
                                </Style>
                                <Style TargetType="{x:Type Label}">
                                    <Setter Property="ContentStringFormat" Value="{}/{0,3}"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="DataContext" Value="{Binding SelectedAreaReference}"/>
                                    <Setter Property="Grid.Column" Value="2"/>
                                </Style>
                            </StackPanel.Resources>

                            <TextBlock Margin="23,0">
                                <Hyperlink Command="{Binding CommandCompleteArea}">Fill All</Hyperlink>
                            </TextBlock>

                            <StackPanel Orientation="Horizontal">
                                <Image Source="{Binding HeartIcon,
                                    Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                                <xctk:IntegerUpDown Text="{Binding Hearts, UpdateSourceTrigger=PropertyChanged}"/>
                                <Label Content="{Binding Hearts}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <Image Source="{Binding WaypointIcon,
                                    Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                                <xctk:IntegerUpDown Text="{Binding Waypoints, UpdateSourceTrigger=PropertyChanged}"/>
                                <Label Content="{Binding Waypoints}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <Image Source="{Binding PoIIcon,
                                    Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                                <xctk:IntegerUpDown Text="{Binding PoIs, UpdateSourceTrigger=PropertyChanged}"/>
                                <Label Content="{Binding PoIs}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <Image Source="{Binding SkillIcon,
                                    Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                                <xctk:IntegerUpDown Text="{Binding Skills, UpdateSourceTrigger=PropertyChanged}"/>
                                <Label Content="{Binding Skills}"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <Image Source="{Binding VistaIcon,
                                    Converter={StaticResource GameIconConverter}, ConverterParameter=Areas}"/>
                                <xctk:IntegerUpDown Text="{Binding Vistas, UpdateSourceTrigger=PropertyChanged}"/>
                                <Label Content="{Binding Vistas}"/>
                            </StackPanel>
                        </StackPanel>

                    </DockPanel>
                </TabItem>

                <TabItem Header="Crafting">
                    <StackPanel>
                        <StackPanel.Resources>
                            <Style TargetType="{x:Type Slider}">
                                <Setter Property="TickPlacement" Value="TopLeft"/>
                                <Setter Property="AutoToolTipPlacement" Value="BottomRight"/>
                                <Setter Property="Minimum" Value="{Binding Source={x:Static Model:CraftingDiscipline.MinLevel}}"/>
                                <Setter Property="Maximum" Value="{Binding Source={x:Static Model:CraftingDiscipline.MaxLevel}}"/>
                                <Setter Property="SmallChange" Value="1"/>
                                <Setter Property="LargeChange" Value="10"/>
                                <Setter Property="Ticks" Value="0, 75, 150, 225, 300, 375, 400"/>
                            </Style>

                            <DataTemplate x:Key="CraftingDisciplineTemplate">
                                <ItemsControl ItemsSource="{Binding}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <DockPanel>
                                                <Image Source="{Binding Name, Converter={StaticResource GameIconConverter},
                                                    ConverterParameter=Crafts}" ToolTip="{Binding Name}" Height="20" Width="20" />

                                                <TextBlock Text="{Binding Source={x:Static Model:CraftingDiscipline.MaxLevel},
                                                    StringFormat=' / {0}'}" DockPanel.Dock="Right" Margin="0,5"/>

                                                <xctk:IntegerUpDown
                                                    Text="{Binding Value, ElementName=sldCraftingDiscipline,
                                                    UpdateSourceTrigger=PropertyChanged}"
                                                    Minimum="{x:Static Model:CraftingDiscipline.MinLevel}"
                                                    Maximum="{x:Static Model:CraftingDiscipline.MaxLevel}"
                                                    SelectAllOnGotFocus="True" DockPanel.Dock="Right"
                                                    Width="55" Height="22" VerticalAlignment="Center"/>

                                                <Slider Value="{Binding Level}" Name="sldCraftingDiscipline" Margin="6,2"/>
                                            </DockPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </StackPanel.Resources>

                        <ContentControl
                            Content="{Binding SelectedCharacter.CraftingDisciplines}"
                            ContentTemplate="{StaticResource CraftingDisciplineTemplate}"/>

                    </StackPanel>
                </TabItem>

                <TabItem Header="Dungeons">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Fractal Tier:" Width="80" VerticalAlignment="Center"/>
                            <xctk:IntegerUpDown Minimum="1" SelectAllOnGotFocus="True" Width="50" Height="22"
                                                Text="{Binding SelectedCharacter.FractalTier, UpdateSourceTrigger=PropertyChanged}"
                                                ToolTip="Highest tier reached in Fractals of the Mists."/>
                        </StackPanel>
                        <GroupBox Header="Dungeon Story Mode Completion">
                            <ContentControl Content="{Binding SelectedCharacter.Dungeons}">
                                <ContentControl.ContentTemplate>
                                    <DataTemplate>
                                        <ItemsControl ItemsSource="{Binding}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <CheckBox IsChecked="{Binding StoryCompleted}">
                                                            <CheckBox.Content>
                                                                <TextBlock>
                                                                    <TextBlock.Text>
                                                                        <MultiBinding StringFormat="{}{0} {1}">
                                                                            <Binding Path="StoryLevel"/>
                                                                            <Binding Path="Name"/>
                                                                        </MultiBinding>
                                                                    </TextBlock.Text>
                                                                </TextBlock>
                                                            </CheckBox.Content>
                                                        </CheckBox>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </DataTemplate>
                                </ContentControl.ContentTemplate>
                            </ContentControl>
                        </GroupBox>
                    </StackPanel>
                </TabItem>

                <TabItem Header="Notes">
                    <DockPanel>
                        <TextBlock Text="Add any personal notes here." DockPanel.Dock="Top"/>
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <TextBox TextWrapping="Wrap" AcceptsReturn="True" AcceptsTab="True" AutoWordSelection="True"
                                     Text="{Binding SelectedCharacter.Notes, UpdateSourceTrigger=PropertyChanged}"/>
                        </ScrollViewer>
                    </DockPanel>
                </TabItem>

            </TabControl>
        </DockPanel>
        <StatusBar Height="23" VerticalAlignment="Bottom">
            <TextBlock Text="{Binding StatusBarUpdateCheck}" ToolTip="{Binding StatusBarUpdateCheck}"/>
        </StatusBar>
    </Grid>
</Window>
